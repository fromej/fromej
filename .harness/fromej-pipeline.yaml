version: 1
kind: pipeline
spec:
  stages:
    - name: build
      type: ci
      spec:
        steps:
          - type: plugin
            spec:
              name: docker
              inputs:
                username: ${{ secrets.get("docker_username") }}
                password: ${{ secrets.get("docker_password") }}
                auto_tag: true
                dockerfile: Dockerfile
                platform: linux/arm64
                registry: http://registry-docker-registry.registry.svc.cluster.local:5000
                repo: http://registry-docker-registry.registry.svc.cluster.local/fromej
                insecure: true
                tags:
                  - latest
                  - ${{ build.commit:0:8 }}
