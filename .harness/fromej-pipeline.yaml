version: 1
kind: pipeline
spec:
  stages:
    - name: deploy
      spec:
        steps:
          - type: plugin
            spec:
              name: docker
              inputs:
                username: ${{ secrets.get("docker_username") }}
                password: ${{ secrets.get("docker_password") }}
                auto_tag: true
                dockerfile: Dockerfile
                platform: linux/arm64
                registry: http://registry-docker-registry.registry.svc.cluster.local:5000
                repo: registry-docker-registry.registry.svc.cluster.local:5000/ej/fromej
                insecure: true
                tags:
                  - latest
                  - "${{DRONE_COMMIT_SHA:0:8}}"
